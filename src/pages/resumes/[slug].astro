---
import fs from "fs";
import path from "path";
import Header from "../../components/Header.astro";
import Sidebar from "../../components/Sidebar.astro";

export async function getStaticPaths() {
  const slugs = [
    "reversing-resume",
    "software-resume",
  ];
  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;

// FILE PATHS
const pdfPath = `/resume-files/${slug}.pdf`;
const pdfFile = path.resolve(`public/resume-files/${slug}.pdf`);

// Google Docs fallback links
const resumeDocs = {
  "reversing-resume":
    "https://docs.google.com/document/d/1vq0oOia3rnEmJH9k46A-wxNwhNEvONlR/preview",
  "software-resume":
    "https://docs.google.com/document/d/1LstuhS9PGSrAqezJtpS2VEKw19_F-1Qe/preview",
};

const hasPdf = fs.existsSync(pdfFile);
const docUrl = resumeDocs[slug] || null;

const titleMap = {
  "reversing-resume": "Reverse Engineering Resume",
  "software-resume": "Software Engineering Resume",
};

const title = titleMap[slug] || slug;
---

<Header title={`${title} | Resume`} />
<body class="resume-page">
  <div class="content">
    <Sidebar selectedItem="resumes" />
    <div class="back-nav-container">
      <a href="/resumes" class="back-nav-button w-inline-block">
        <img
          src="/assets/back.svg"
          loading="lazy"
          alt="Back"
          class="back-nav-img"
        />
        <div>Back</div>
      </a>
    </div>
    <main class="resume-main">
      <h1 class="resume-title">{title}</h1>
      <section class="download-resume-links">
        {
          hasPdf ? (
            <a href={pdfPath} download class="download-btn">
              Download PDF
            </a>
          ) : docUrl ? (
            <a
              href={docUrl.replace("/preview", "/view")}
              target="_blank"
              rel="noopener noreferrer"
              class="download-btn"
            >
              View Google Doc
            </a>
          ) : (
            <a class="download-btn disabled">No resume available</a>
          )
        }
      </section>
      {
        hasPdf ? (
          <section class="pdf-viewer">
            <object
              data={pdfPath}
              type="application/pdf"
              width="100%"
              height="100%"
            >
              <p>
                Your browser doesn't support PDF embed. You can{" "}
                <a href={pdfPath}>download the PDF</a> instead.
              </p>
            </object>
          </section>
        ) : docUrl ? (
          <section class="pdf-viewer">
            <iframe
              src={docUrl}
              width="100%"
              height="120vh"
              style="border:none; border-radius:6px;"
            />
          </section>
        ) : (
          <section class="pdf-viewer">
            <p style="text-align:center; padding:2rem; color:#ccc;">
              No resume PDF or Google Doc found for this entry.
            </p>
          </section>
        )
      }
    </main>
  </div>

  <style>
    .resume-page .content {
      display: flex;
      height: auto;
      min-height: 100vh;
      width: 100vw;
      overflow: visible;
    }

    .resume-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #fff;
      overflow-y: auto;
      padding: 2rem 2rem 4rem;

      background-image: linear-gradient(
          rgba(28, 28, 28, 0.64),
          rgba(28, 28, 28, 0.64)
        ),
        url("/assets/grid-top-right.svg"),
        linear-gradient(rgba(28, 28, 28, 0.24), rgba(28, 28, 28, 0.24));
      background-position:
        0 0,
        0 0,
        0 0;
      background-size:
        auto,
        auto 1130px,
        auto;
    }

    .back-nav-container {
      align-self: flex-start;
      margin-bottom: 1rem;
    }

    .resume-title {
      font: inherit;
      text-align: center;
      font-size: clamp(2rem, 3vw, 3.5rem);
      font-weight: 400;
      margin-top: 3rem;
      margin-bottom: 1.5rem;
    }

    .resume-title::after {
      content: "";
      display: block;
      margin: 2rem auto 0 auto;
    }

    .download-resume-links {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2rem;
    }

    .download-btn {
      background: #222;
      color: #fff;
      padding: 0.6rem 1.4rem;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      letter-spacing: 0.3px;
      transition: all 0.25s ease;
    }

    .download-btn:hover {
      background: #444;
      transform: translateY(-2px);
    }

    .download-btn.disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .pdf-viewer {
      position: relative;
      width: 75%;
      max-width: 85vw;
      border-radius: 6px;
      overflow: visible;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .pdf-viewer object,
    .pdf-viewer iframe {
      width: 100%;
      height: 120vh;
      display: block;
      border: none;
      border-radius: inherit;
      background: transparent;
    }

    @media (max-width: 900px) {
      .pdf-viewer {
        width: 95%;
        max-width: 95vw;
        border-radius: 6px;
        margin-bottom: 2rem;
      }

      .pdf-viewer object,
      .pdf-viewer iframe {
        height: 80vh;
      }
    }
  </style>
</body>
